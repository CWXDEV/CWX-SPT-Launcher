@page "/Profiles"
@inject ISnackbar Snackbar
@inject IDialogService DialogService

<MudContainer Class="px-8 my-8" MaxWidth="MaxWidth.Large">
    <MudContainer Class="mt-n6 mb-3 pa-0 d-flex justify-space-between">
        <MudButton Color="Color.Primary" StartIcon="@Icons.Material.Filled.PersonAdd" Size="Size.Large" @onclick="() => RunAddTask()" Variant="Variant.Outlined">Create New Profile</MudButton>
        <MudButton Class="ml-2" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Login" Size="Size.Large" Variant="Variant.Outlined">Login with details</MudButton>
    </MudContainer>
    <MudGrid>
        @foreach (var profile in ProfilesList)
        {
            <ProfileCardComponent Profile="@profile" @bind-ProfileList="ProfilesList" />
        }
        @if (ProfilesList.Count == 0)
        {
            <MudItem sm="12">
                <MudAlert Severity="Severity.Info" Variant="Variant.Outlined">If you are connected to a server, please use the above "Login with details" button.</MudAlert>
            </MudItem>
        }
    </MudGrid>
</MudContainer>

@code {

    public List<SptProfileClass> ProfilesList = new List<SptProfileClass>()
    {
        new SptProfileClass
        {
            Id = "122222222222222222222",
            Name = "CWX",
            Password = "",
            Side = "BEAR",
            Level = "69",
            Edition = "The Unheard Edition"
        },
        new SptProfileClass
        {
            Id = "222222222222222222222",
            Name = "Waffle",
            Password = "Waffle",
            Side = "USEC",
            Level = "420",
            Edition = "Edge Of Darkness"
        },
        new SptProfileClass
        {
            Id = "122222222222222222222",
            Name = "CWX",
            Password = "",
            Side = "BEAR",
            Level = "69",
            Edition = "The Unheard Edition"
        },
        new SptProfileClass
        {
            Id = "222222222222222222222",
            Name = "Waffle",
            Password = "Waffle",
            Side = "USEC",
            Level = "420",
            Edition = "Edge Of Darkness"
        },
        new SptProfileClass
        {
            Id = "333333333333333333333",
            Name = "Noob",
            Password = "Waffle",
            Side = "USEC",
            Level = "1",
            Edition = "Standard Edition"
        }
    };

    private async Task RunAddTask()
    {
        var dialog = await DialogService.ShowAsync<ProfileAddDialog>("ProfileAddDialog", SettingsHelper.Instance.DialogOptions);
        var result = await dialog.Result;

        if (!result.Canceled)
        {
            // call server and add new empty profile
            ProfilesList.Add(result.Data as SptProfileClass);
        }
    }
}